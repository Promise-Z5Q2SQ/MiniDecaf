# MiniDecaf实验Step11实验报告

<div style="text-align: center;">2018011358 朱书琦</div>

## 实验内容

本步骤实现了指针和显示类型转换的支持，为此新增或修改的语法规范如下。

```
type: 'int' '*'*;

assignment : conditional | unary '=' expression;

unary:
	('-' | '~' | '!' | '&' | '*') unary	# operatorUnary
	| '(' type ')' unary # castUnary
	| postfix # postfixUnary;
```

要在代码中的变化较多，首先是为指针类型增加 `PointerType` 类型，同时在类型中需要确定该类型的左右值，也新增了左右值转化、引用和解引用函数。

在主处理过程中，需要增加左值分析，排除类似 `1+2=3` 或是 `&(1+2)` 的代码；也要在之前每个用到类型变量的地方增加类型检查，因为实现中禁止隐式类型转化，但是允许显式类型转化，同时 `&` 的操作数必须是指针类型，`*` 的操作类型必须是指针类型等。

在处理过程中需要考虑到空指针被定义成值为 0 的指针，因为禁止隐式类型转换，所以必须由 0 显式转化而来，解引用空指针是未定义行为。

## 思考题

1. 需要先进行名称解析获取每个变量的类型以及函数的返回值类型，再进行类型检查判断所需类型和现有类型是否一致。
2. 在 C++ 中，char 类型的数组类型可以隐式转化为 char 类型的指针。
3. 需要注意不同类型指针比较大小无意义，不能和原来整数比较方法一样，要在比较时采用无符号整数比较方式。

## 相关参考

如实验内容部分所述，主要参考了实验指导书和所给的 java 样例代码。